<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Wavetech</title>

	<!-- Tailwind -->
	<script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/datepicker.min.js"></script>
	<!-- Add Firebase SDK -->
	<script type="module" src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
	<script type="module" src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js"></script>
	<!-- sweetalert2 -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<!-- flatpickr -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</head>

<body class="bg-gray-100">
	<div>
		<div class="md:hidden fixed top-0 left-0 w-full bg-gray-800 z-40">
			<div class="flex justify-between items-center px-4 py-3">
				<div>
					<img class="h-8 w-auto text-white" src="" alt="Wavetech">
				</div>
				<button id="openDashboardButton" class="text-white focus:outline-none">
					<span class="sr-only">Open dashboard</span>
					<!-- Heroicon name: outline/menu -->
					<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
						stroke="currentColor" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
							d="M4 6h16M4 12h16m-7 6h7"></path>
					</svg>
				</button>
			</div>
		</div>


		<!-- Off-canvas menu for mobile, show/hide based on off-canvas menu state. -->
		<div class="fixed inset-0 flex z-40 md:hidden hidden" role="dialog" aria-modal="true" id="mobileDashboard">
			<div class="fixed inset-0 bg-gray-600 bg-opacity-75" aria-hidden="true"></div>
			<div class="relative flex-1 flex flex-col max-w-xs w-full pt-5 pb-4 bg-gray-800">
				<div class="absolute top-0 right-0 -mr-12 pt-2">
					<button type="button"
						class="ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
						onclick="document.getElementById('mobileDashboard').classList.add('hidden')">
						<span class="sr-only">Close sidebar</span>
						<!-- Heroicon name: outline/x -->
						<svg class="h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
							viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M6 18L18 6M6 6l12 12" />
						</svg>
					</button>
				</div>

				<div class="flex-shrink-0 flex items-center px-4">
					<img class="h-8 w-auto text-white" src="" alt="Wavetech">
				</div>
				<div class="mt-5 flex-1 h-0 overflow-y-auto">
					<nav class="px-2 space-y-1">
						<!-- Current: "bg-gray-900 text-white", Default: "text-gray-300 hover:bg-gray-700 hover:text-white" -->
						<a href="#" id="folha-obra-link"
							class="text-gray-300 hover:bg-gray-700 hover:text-white group flex items-center px-2 py-2 text-base font-medium rounded-md">
							<svg class="text-gray-300 mr-4 flex-shrink-0 h-6 w-6" xmlns="http://www.w3.org/2000/svg"
								fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
							</svg>
							Folha de Obra
						</a>

						<a href="#" id="consulta-folha-link"
							class="text-gray-300 hover:bg-gray-700 hover:text-white group flex items-center px-2 py-2 text-base font-medium rounded-md">
							<svg class="text-gray-400 group-hover:text-gray-300 mr-4 flex-shrink-0 h-6 w-6"
								xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
								aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
							</svg>
							Consulta de Folha
						</a>
					</nav>
				</div>
			</div>

			<script>

			</script>

			<div class="flex-shrink-0 w-14" aria-hidden="true">
				<!-- Dummy element to force sidebar to shrink to fit close icon -->
			</div>
		</div>

		<!-- Static sidebar for desktop -->
		<div class="hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0">
			<div class="flex-1 flex flex-col min-h-0 bg-gray-800">
				<div class="flex items-center h-16 flex-shrink-0 px-4 bg-gray-900">
					<img class="h-8 w-auto text-white" src="" alt="Wavetech">
				</div>
				<div class="flex-1 flex flex-col overflow-y-auto">
					<nav class="flex-1 px-2 py-4 space-y-1">
						<a href="#" id="folha-obra-desktop"
							class="bg-gray-900 text-white group flex items-center px-2 py-2 text-sm font-medium rounded-md">
							<svg class="text-gray-300 mr-3 flex-shrink-0 h-6 w-6" xmlns="http://www.w3.org/2000/svg"
								fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
							</svg>
							Folha de Obra
						</a>

						<a href="#" id="consulta-folha-desktop"
							class="text-gray-300 hover:bg-gray-700 hover:text-white group flex items-center px-2 py-2 text-sm font-medium rounded-md">
							<svg class="text-gray-400 group-hover:text-gray-300 mr-3 flex-shrink-0 h-6 w-6"
								xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
								aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
							</svg>
							Consulta de Folhas
						</a>
					</nav>
				</div>
			</div>
		</div>

		<!-- Divs from main page -->
		<div class="md:pl-64 flex flex-col">
			<main class="flex-1 bg-gray-100">
				<div class="py-6 mt-10" id="conteudo">
					<!-- Conteúdo da Folha de Obra -->
					<div id="folha-obra-conteudo">
						<div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8">
							<h1 class="text-2xl font-semibold text-gray-900"></h1>
						</div>
						<div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8">
							<!-- Replace with your content -->
							<div class="py-4">
								<div class="space-y-6">
									<!-- Embarcação -->
									<div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6 relative">
										<div class="md:grid md:grid-cols-3 md:gap-6">
											<div class="md:col-span-1">
												<h3 class="text-lg font-medium leading-6 text-gray-900">Embarcação</h3>
												<p class="mt-1 text-sm text-gray-500">Informações básicas sobre a
													embarcação, como nome, tipo e dimensões.</p>
												<button
													class="toggle-btn absolute top-4 right-4 text-gray-500 text-2xl">+</button>
											</div>
											<div class="mt-5 md:mt-0 md:col-span-2 expandable-section">
												<form class="space-y-6" action="#" method="POST">
													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700"> Nome
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="nome_embarcacao"
																	id="nome_embarcacao"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Local
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="local_embarcacao"
																	id="local_embarcacao"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700"> Cais
																/
																Lugar
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="cais_embarcacao"
																	id="cais_embarcacao"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>

									<!-- Faturação -->
									<div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6 relative">
										<div class="md:grid md:grid-cols-3 md:gap-6">
											<div class="md:col-span-1">
												<h3 class="text-lg font-medium leading-6 text-gray-900">Faturação</h3>
												<p class="mt-1 text-sm text-gray-500">Detalhes financeiros e de
													pagamento
													relacionados ao serviço.</p>
												<button
													class="toggle-btn absolute top-4 right-4 text-gray-500 text-2xl">+</button>
											</div>
											<div class="mt-5 md:mt-0 md:col-span-2 expandable-section hidden">
												<form class="space-y-6" action="#" method="POST">
													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Fatura
																nº
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="nfatura" id="nfatura"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700"> Data
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input datepicker type="text" id="data_fatura"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Observações
															</label>
															<div class="mt-1">
																<textarea id="observacoes_fatura"
																	name="observacoes_fatura" rows="3"
																	class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
															</div>
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>

									<!-- Detalhes da Embarcação -->
									<div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6 relative">
										<div class="md:grid md:grid-cols-3 md:gap-6">
											<div class="md:col-span-1">
												<h3 class="text-lg font-medium leading-6 text-gray-900">Detalhes da
													Embarcação</h3>
												<p class="mt-1 text-sm text-gray-500">Especificações adicionais da
													embarcação, incluindo características técnicas.</p>
												<button
													class="toggle-btn absolute top-4 right-4 text-gray-500 text-2xl">+</button>
											</div>
											<div class="mt-5 md:mt-0 md:col-span-2 expandable-section hidden">
												<form class="space-y-6" action="#" method="POST">
													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Marca
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="marca" id="marca"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Modelo
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="modelo" id="modelo"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Tamanho
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="tamanho" id="tamanho"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Motor
																(S) -
																Nº de Série
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="motor" id="motor"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Caixa /
																Coluna - Nº Serie
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="nserie" id="nserie"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>

									<!-- Cliente -->
									<div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6 relative">
										<div class="md:grid md:grid-cols-3 md:gap-6">
											<div class="md:col-span-1">
												<h3 class="text-lg font-medium leading-6 text-gray-900">Cliente</h3>
												<p class="mt-1 text-sm text-gray-500">Dados do cliente, como nome,
													contato e
													informações de faturamento.</p>
												<button
													class="toggle-btn absolute top-4 right-4 text-gray-500 text-2xl">+</button>
											</div>
											<div class="mt-5 md:mt-0 md:col-span-2 expandable-section hidden">
												<form class="space-y-6" action="#" method="POST">
													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Exmo.
																Sr.
																(a)
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="nome_cliente" id="nome_cliente"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Empresa
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="empresa_cliente"
																	id="empresa_cliente"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Morada
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="morada_cliente"
																	id="morada_cliente"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Código
																Postal
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="cp_cliente" id="cp_cliente"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Telefone
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="telefone_cliente"
																	id="telefone_cliente"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Email
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="email_cliente"
																	id="email_cliente"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>

													<div class="grid grid-cols-3 gap-6">
														<div class="col-span-3 sm:col-span-2">
															<label class="block text-sm font-medium text-gray-700">
																Contribuinte
															</label>
															<div class="mt-1 flex rounded-md shadow-sm">
																<input type="text" name="contribuinte_cliente"
																	id="contribuinte_cliente"
																	class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300">
															</div>
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>

									<!-- Serviços a Executar -->
									<div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6 relative">
										<div class="md:grid md:grid-cols-3 md:gap-6">
											<div class="md:col-span-1">
												<h3 class="text-lg font-medium leading-6 text-gray-900">Serviços a
													Executar
												</h3>
												<p class="mt-1 text-sm text-gray-500">Lista dos serviços a serem
													realizados
													na embarcação.</p>
												<!-- Add the toggle button here -->
												<button
													class="toggle-btn absolute top-4 right-4 text-gray-500 text-2xl">+</button>
											</div>
											<!-- Wrap the expandable content in a div with the `expandable-section` class and add `hidden` -->
											<div class="mt-5 md:mt-0 md:col-span-2 expandable-section hidden">
												<form action="#" method="POST">
													<div class="grid grid-cols-6 gap-6">
														<!-- Bullet Point System for Tasks -->
														<div class="col-span-6">
															<label
																class="block text-sm font-medium text-gray-700">Serviços
																a Executar</label>
															<div id="task-list" class="mt-2 space-y-4">
																<!-- Tasks will be dynamically added here -->
															</div>
															<div class="mt-2 flex">
																<input type="text" id="nome_tarefa"
																	placeholder="Adicionar novo serviço"
																	class="flex-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
																<button type="button" id="add-task-btn"
																	class="ml-2 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
																	Adicionar</button>
															</div>
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>
									<!-- Descrição de Trabalhos -->
									<div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6 relative">
										<div class="md:grid md:grid-cols-3 md:gap-6">
											<div class="md:col-span-1">
												<h3 class="text-lg font-medium leading-6 text-gray-900">Descrição de
													Trabalhos</h3>
												<p class="mt-1 text-sm text-gray-500">Registe o dia, as horas
													trabalhadas,
													os colaboradores envolvidos e uma
													descrição detalhada das atividades realizadas.</p>
												<button
													class="toggle-btn absolute top-4 right-4 text-gray-500 text-2xl">+</button>
											</div>
											<div class="mt-5 md:mt-0 md:col-span-2 hidden expandable-section">
												<form action="#" method="POST">
													<div class="grid grid-cols-6 gap-6">

														<!-- Bullet Point System for Tasks -->
														<div class="col-span-6">
															<label
																class="block text-sm font-medium text-gray-700">Tarefas
																Realizadas</label>
															<div id="work-task-list" class="mt-2 space-y-4">
																<!-- Tasks will be dynamically added here -->
															</div>
															<div class="mt-2 flex">
																<input type="text" id="tarefas_realizadas"
																	placeholder="Adicionar nova tarefa"
																	class="flex-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
																<button type="button" id="add-work-task-btn"
																	class="ml-2 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">Adicionar</button>
															</div>
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>

									<!-- Materiais Aplicados e Subst. -->
									<button id="addRowBtn"
										class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded my-4">Adicionar
										Material</button>

									<div class="overflow-x-auto">
										<table class="min-w-full bg-white rounded-lg overflow-hidden"
											id="materialTable">
											<thead class="bg-gray-50">
												<tr>
													<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
														id="referencia">
														Referência
													</th>
													<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
														id="Quantidade">
														Quantidade
													</th>
													<th
														class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
														Designação
													</th>
													<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
														id="PrecoUnitario">
														Preço Unitário
													</th>
													<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
														id="PrecoTotal">
														Preço Total
													</th>
												</tr>
											</thead>
											<tbody class="divide-y divide-gray-200">
												<!-- Table rows will be dynamically added here -->
											</tbody>
											<tfoot>
												<tr class="bg-gray-100">
													<td colspan="4"
														class="px-6 py-3 text-right text-sm font-medium text-gray-700">
														Total
														de Materiais c/ Iva
													</td>
													<td id="totalValue"
														class="px-6 py-3 text-sm font-medium text-gray-700">
														<span
															class="inline-block bg-gray-200 rounded-md px-2 py-1">0.00</span>
													</td>
												</tr>
											</tfoot>
										</table>
									</div>

									<div class="flex justify-end">
										<button type="button"
											class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Cancel</button>
										<button type="submit" id="saveBtn"
											class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Save</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Conteúdo da Consulta de Folha (inicialmente escondido) -->
					<div id="consulta-folha-conteudo" class="hidden">
						<div class="bg-gray-100 p-6">
							<div class="container mx-auto bg-white p-8 rounded-xl shadow-lg">
								<h2 class="text-2xl font-semibold text-gray-800 mb-6">Consulta de folhas</h2>
								<div class="overflow-x-auto">
									<table class="w-full border-collapse text-sm table-auto shadow-sm rounded-lg">
										<thead>
											<tr class="bg-gray-100 text-left text-gray-600">
												<th class="border px-6 py-4 text-sm font-medium">Nome da Embarcação</th>
												<th class="border px-6 py-4 text-sm font-medium">Nº Fatura</th>
												<th class="border px-6 py-4 text-sm font-medium">Cliente</th>
												<th class="border px-6 py-4 text-sm font-medium">Data</th>
												<th class="border px-6 py-4 text-sm font-medium">Ações</th>
											</tr>
										</thead>
										<tbody id="tableBody" class="text-gray-700">
											<!-- Table rows will be populated dynamically -->
										</tbody>
									</table>
								</div>
							</div>

							<!-- Modal Section -->
							<div id="modal"
								class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center p-4">
								<div
									class="bg-white p-6 rounded shadow-lg w-full max-w-sm md:max-w-lg lg:max-w-xl mt-6 mb-6 max-h-[80vh] overflow-y-auto">
									<h2 class="text-lg font-bold mb-4">Detalhes</h2>
									<input type="hidden" id="entryId">
									<div id="modalContent"></div>
									<div class="flex justify-end gap-2 mt-4">
										<button onclick="updateEntry()"
											class="bg-blue-500 text-white px-4 py-2 rounded">Salvar</button>
										<button id="deleteButton"
											class="bg-red-600 text-white px-5 py-2 rounded hover:bg-red-700 transition">Excluir</button>
										<button onclick="closeModal()"
											class="bg-gray-500 text-white px-4 py-2 rounded">Fechar</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>
	</div>
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
		import {
			getFirestore, getDocs, deleteDoc, updateDoc,
			collection,
			doc,
			getDoc,
			setDoc,
			addDoc,
		} from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

		const firebaseConfig = {
			apiKey: "AIzaSyA4eL1beu6fMptD9n1EDIbwG3XN3CMIBr4",
			authDomain: "wavetech-9cd4f.firebaseapp.com",
			projectId: "wavetech-9cd4f",
			storageBucket: "wavetech-9cd4f.firebasestorage.app",
			messagingSenderId: "705459696168",
			appId: "1:705459696168:web:8f7065acf0218eb0f23b1d"
		};


		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const db = getFirestore(app);

		// Function to toggle dashboard visibility
		function toggleDashboard() {
			var dashboard = document.getElementById('mobileDashboard');
			dashboard.classList.toggle('hidden');
		}

		// Function to close the dashboard
		function closeDashboard() {
			var dashboard = document.getElementById('mobileDashboard');
			dashboard.classList.add('hidden');
		}

		// Add event listener to the button to toggle dashboard
		document.addEventListener('DOMContentLoaded', function () {
			var toggleButton = document.getElementById('openDashboardButton');
			toggleButton.addEventListener('click', toggleDashboard);

			// Add event listener to the close button inside the dashboard
			var closeButton = document.querySelector('#mobileDashboard button');
			closeButton.addEventListener('click', closeDashboard);
		});

		const folhaObraCollection = collection(db, "folhaObra");

		// Adicionar eventListener ao botão "Excluir"
		document.getElementById("deleteButton").addEventListener("click", deleteEntry);

		async function fetchData() {
			const snapshot = await getDocs(folhaObraCollection);
			const tableBody = document.getElementById("tableBody");
			tableBody.innerHTML = "";

			snapshot.forEach(doc => {
				const data = doc.data();
				const row = `<tr class="border-b">
						<td class="px-4 py-2">${data.embarcacao.nome}</td>
						<td class="px-4 py-2">${data.faturacao.fatura}</td>
						<td class="px-4 py-2">${data.cliente.nome}</td>
						<td class="px-4 py-2">${data.faturacao.data}</td>
						<td class="px-4 py-2 flex gap-2">
							<button onclick="showDetails('${doc.id}')" class="bg-green-500 text-white px-2 py-1 rounded">Detalhes</button>
						</td>
					</tr>`;
				tableBody.innerHTML += row;
			});
		}

		async function showDetails(id) {
			const docRef = doc(db, "folhaObra", id);
			const docSnap = await getDocs(folhaObraCollection);
			let data;
			docSnap.forEach(d => { if (d.id === id) data = d.data(); });

			document.getElementById("modal").classList.remove("hidden");
			document.getElementById("entryId").value = id;
			document.getElementById("modalContent").innerHTML = `
				<div class="p-6 space-y-6">
					<div>
						<h3 class="text-2xl font-semibold text-gray-800 mb-4">Embarcação</h3>
						<div class="space-y-2">
							<label class="font-medium text-gray-700">Nome:</label>
							<input type="text" id="boatName" class="w-full border p-2 rounded-md text-gray-700" value="${data.embarcacao.nome}" >
		
							<label class="font-medium text-gray-700">Local:</label>
							<input type="text" id="boatLocal" class="w-full border p-2 rounded-md text-gray-700" value="${data.embarcacao.local}" >
		
							<label class="font-medium text-gray-700">Cais:</label>
							<input type="text" id="boatCais" class="w-full border p-2 rounded-md text-gray-700" value="${data.embarcacao.cais}" >
						</div>
					</div>
		
					<div class="border-t-2 border-gray-300 pt-6">
						<h3 class="text-2xl font-semibold text-gray-800 mb-4">Faturação</h3>
						<div class="space-y-2">
							<label class="font-medium text-gray-700">Fatura:</label>
							<input type="text" id="invoice" class="w-full border p-2 rounded-md text-gray-700" value="${data.faturacao.fatura}" >
		
							<label class="font-medium text-gray-700">Data:</label>
							<input type="text" id="invoiceDate" class="w-full border p-2 rounded-md text-gray-700" value="${data.faturacao.data}" >
		
							<label class="font-medium text-gray-700">Observações:</label>
							<input type="text" id="invoiceObs" class="w-full border p-2 rounded-md text-gray-700" value="${data.faturacao.observacoes}" >
						</div>
					</div>
		
					<div class="border-t-2 border-gray-300 pt-6">
						<h3 class="text-2xl font-semibold text-gray-800 mb-4">Cliente</h3>
						<div class="space-y-2">
							<label class="font-medium text-gray-700">Nome:</label>
							<input type="text" id="clientName" class="w-full border p-2 rounded-md text-gray-700" value="${data.cliente.nome}" >
		
							<label class="font-medium text-gray-700">Empresa:</label>
							<input type="text" id="clientCompany" class="w-full border p-2 rounded-md text-gray-700" value="${data.cliente.empresa}" >
		
							<label class="font-medium text-gray-700">Morada:</label>
							<input type="text" id="clientAddress" class="w-full border p-2 rounded-md text-gray-700" value="${data.cliente.morada}" >
		
							<label class="font-medium text-gray-700">Telefone:</label>
							<input type="text" id="clientPhone" class="w-full border p-2 rounded-md text-gray-700" value="${data.cliente.telefone}" >
		
							<label class="font-medium text-gray-700">Email:</label>
							<input type="text" id="clientEmail" class="w-full border p-2 rounded-md text-gray-700" value="${data.cliente.email}" >
						</div>
					</div>
		
					<div class="border-t-2 border-gray-300 pt-6">
						<h3 class="text-2xl font-semibold text-gray-800 mb-4">Serviços a Executar</h3>
						<div class="space-y-4">
							${data.tarefas.map((tarefa, index) => `
								<div class="space-y-2">
									<label class="font-medium text-gray-700">Nome:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${tarefa.nome}" >
		
									<label class="font-medium text-gray-700">Observações:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${tarefa.notes}" >
		
									<label class="font-medium text-gray-700">Data de Recepção:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${tarefa.receptionDate}" >
		
									<label class="font-medium text-gray-700">Data de Entrega:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${tarefa.deliveryDate}" >
		
									<label class="font-medium text-gray-700">Responsável:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${tarefa.responsible}" >
								</div>
								${index < data.tarefas.length - 1 ? '<hr class="my-4 border-black">' : ''}
							`).join('')}
						</div>
					</div>
		
					<div class="border-t-2 border-gray-300 pt-6">
						<h3 class="text-2xl font-semibold text-gray-800 mb-4">Descrição de Trabalhos</h3>
						<div class="space-y-4">
							${data.trabalhos.map((trabalho, index) => `
								<div class="space-y-2">
									<label class="font-medium text-gray-700">Data:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${trabalho.date}" >
		
									<label class="font-medium text-gray-700">Horas:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${trabalho.hours}" >
		
									<label class="font-medium text-gray-700">Colaboradores:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${trabalho.collaborators}" >
		
									<label class="font-medium text-gray-700">Descrição:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${trabalho.description}" >
								</div>
								${index < data.trabalhos.length - 1 ? '<hr class="my-4 border-black">' : ''}
							`).join('')}
						</div>
					</div>
		
					<div class="border-t-2 border-gray-300 pt-6">
						<h3 class="text-2xl font-semibold text-gray-800 mb-4">Materiais</h3>
						<div class="space-y-4">
							${data.materiais.map((material, index) => `
								<div class="space-y-2">
									<label class="font-medium text-gray-700">Referência:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${material.referencia}" >
		
									<label class="font-medium text-gray-700">Designação:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${material.designacao}" >
		
									<label class="font-medium text-gray-700">Quantidade:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${material.quantidade}" >
		
									<label class="font-medium text-gray-700">Preço Unitário:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${material.precoUni}" >
		
									<label class="font-medium text-gray-700">Preço Total:</label>
									<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${material.precoTotal}" >
								</div>
								${index < data.materiais.length - 1 ? '<hr class="my-4 border-black">' : ''}
							`).join('')}
						</div>
		
						<div class="pt-4">
							<label class="font-medium text-gray-700">Preço Total (c/ IVA):</label>
							<input type="text" class="w-full border p-2 rounded-md text-gray-700" value="${data.materiais.reduce((acc, material) => acc + parseFloat(material.precoTotalcIva || 0), 0)}" >
						</div>
					</div>
				</div>
			`;
		}

		// Função de confirmação ao salvar
		async function updateEntry() {
			const entryId = document.getElementById("entryId").value;

			// Usando SweetAlert para confirmação
			const result = await Swal.fire({
				title: 'Tem certeza?',
				text: 'Você quer salvar as mudanças?',
				icon: 'warning',
				showCancelButton: true,
				confirmButtonText: 'Salvar',
				cancelButtonText: 'Cancelar',
				reverseButtons: true,
			});

			if (result.isConfirmed) {
				try {
					// A lógica para salvar a entrada vai aqui (atualizar o Firebase)
					// Exemplo de uma atualização fictícia
					const docRef = doc(db, "folhaObra", entryId);
					await updateDoc(docRef, {
						embarcacao: {
							nome: document.getElementById('boatName').value,
							local: document.getElementById('boatLocal').value,
							cais: document.getElementById('boatCais').value,
						},
						faturacao: {
							fatura: document.getElementById('invoice').value,
							data: document.getElementById('invoiceDate').value,
							observacoes: document.getElementById('invoiceObs').value,
						},
						cliente: {
							nome: document.getElementById('clientName').value,
							empresa: document.getElementById('clientCompany').value,
							morada: document.getElementById('clientAddress').value,
							telefone: document.getElementById('clientPhone').value,
							email: document.getElementById('clientEmail').value,
						},
						tarefas: Array.from(document.querySelectorAll('.task-row')).map((taskRow, index) => ({
							nome: taskRow.querySelector('.task-name').value,
							notes: taskRow.querySelector('.task-notes').value,
							receptionDate: taskRow.querySelector('.task-receptionDate').value,
							deliveryDate: taskRow.querySelector('.task-deliveryDate').value,
							responsible: taskRow.querySelector('.task-responsible').value,
						})),
						trabalhos: Array.from(document.querySelectorAll('.work-row')).map((workRow, index) => ({
							date: workRow.querySelector('.work-date').value,
							hours: workRow.querySelector('.work-hours').value,
							collaborators: workRow.querySelector('.work-collaborators').value,
							description: workRow.querySelector('.work-description').value,
						})),
						materiais: Array.from(document.querySelectorAll('.material-row')).map((materialRow, index) => ({
							referencia: materialRow.querySelector('.material-referencia').value,
							designacao: materialRow.querySelector('.material-designacao').value,
							quantidade: materialRow.querySelector('.material-quantidade').value,
							precoUni: materialRow.querySelector('.material-precoUni').value,
							precoTotal: materialRow.querySelector('.material-precoTotal').value,
						})),
					});

					// Notificar o usuário que foi salvo com sucesso
					Swal.fire('Salvo!', 'As mudanças foram salvas.', 'success');

					// Fechar o modal após salvar
					closeModal();

				} catch (error) {
					console.error("Erro ao salvar: ", error);
					Swal.fire('Erro!', 'Houve um problema ao salvar a entrada.', 'error');
				}
			}
		}

		// Função de confirmação ao excluir
		async function deleteEntry() {
			const entryId = document.getElementById("entryId").value;
			const docRef = doc(db, "folhaObra", entryId);  // Refere-se ao documento do Firestore

			// Usando SweetAlert para confirmação
			const result = await Swal.fire({
				title: 'Tem certeza?',
				text: 'Você deseja excluir esta entrada?',
				icon: 'warning',
				showCancelButton: true,
				confirmButtonText: 'Excluir',
				cancelButtonText: 'Cancelar',
				reverseButtons: true,
			});

			if (result.isConfirmed) {
				try {
					// Exclui o documento na base de dados
					await deleteDoc(docRef);

					// Atualiza a tabela e remove a linha excluída
					const row = document.getElementById(entryId);
					if (row) {
						row.remove();
					}

					// Exibe uma mensagem de sucesso
					Swal.fire({
						icon: 'success',
						title: 'Excluído!',
						text: 'A entrada foi excluída com sucesso!',
					});

					// Fecha o modal e atualiza a tabela
					fetchData();  // Atualiza a tabela
					closeModal(); // Fecha o modal
				} catch (error) {
					// Exibe mensagem de erro caso algo dê errado
					Swal.fire({
						icon: 'error',
						title: 'Erro!',
						text: 'Ocorreu um erro ao excluir a entrada.',
					});
				}
			}
		}

		// Função para fechar o modal
		function closeModal() {
			document.getElementById("modal").classList.add("hidden");
		}

		window.onload = fetchData;
		window.showDetails = showDetails;
		window.updateEntry = updateEntry;
		window.closeModal = closeModal;

		document.addEventListener('DOMContentLoaded', function () {
			const taskList = document.getElementById('task-list');
			const newTaskInput = document.getElementById('nome_tarefa');
			const addTaskBtn = document.getElementById('add-task-btn');

			let taskCounter = 0;

			addTaskBtn.addEventListener('click', function () {
				const taskText = newTaskInput.value.trim();
				if (taskText) {
					const taskId = `task-${taskCounter++}`;
					const taskItem = document.createElement('div');
					taskItem.className = 'bg-gray-50 p-4 rounded-lg shadow-sm';
					taskItem.id = taskId;

					taskItem.innerHTML = `
						<div class="flex items-center justify-between">
							<label class="flex items-center space-x-3 cursor-pointer">
								<input type="checkbox" value="checked" id="checkbox_servicos-${taskId}" class="form-checkbox h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
								<span class="text-gray-700 font-medium" id="text_servicos-${taskId}">${taskText}</span>
							</label>
							<button id="delete_servicos-${taskId}" class="text-red-500 text-2xl hover:text-red-700">×</button>
						</div>
						<div class="mt-4 grid grid-cols-6 gap-4">
							<div class="col-span-6">
								<label for="notes-${taskId}" class="block text-sm font-medium text-gray-700">Observações</label>
								<textarea id="notes_servicos-${taskId}" rows="2" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"></textarea>
							</div>
							<div class="col-span-6 sm:col-span-3">
								<label for="reception-date-${taskId}" class="block text-sm font-medium text-gray-700">Data de Recepção</label>
								<input type="text" id="reception-date_servicos-${taskId}" class="datepicker mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
							</div>
							<div class="col-span-6 sm:col-span-3">
								<label for="delivery-date-${taskId}" class="block text-sm font-medium text-gray-700">Data de Entrega</label>
								<input type="text" id="delivery-date_servicos-${taskId}" class="datepicker mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
							</div>
							<div class="col-span-6">
								<label for="responsible-${taskId}" class="block text-sm font-medium text-gray-700">O Responsável</label>
								<input type="text" id="responsible_servicos-${taskId}" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
							</div>
						</div>
					`;

					taskList.appendChild(taskItem);
					newTaskInput.value = '';

					// Apply Flatpickr to newly added date fields
					taskItem.querySelectorAll('.datepicker').forEach(input => {
						flatpickr(input, {
							dateFormat: "d/m/Y",
							allowInput: true
						});
					});

					// Delete button functionality
					document.getElementById(`delete_servicos-${taskId}`).addEventListener('click', function () {
						taskList.removeChild(document.getElementById(taskId));
					});
				}
			});
		});

		document.addEventListener('DOMContentLoaded', function () {
			const workTaskList = document.getElementById('work-task-list');
			const newWorkTaskInput = document.getElementById('tarefas_realizadas');
			const addWorkTaskBtn = document.getElementById('add-work-task-btn');
			let taskCounter = 0; // Auto-incrementing ID counter

			addWorkTaskBtn.addEventListener('click', function () {
				const taskText = newWorkTaskInput.value.trim();
				if (taskText) {
					const taskId = `task-${taskCounter}`; // Generate unique ID

					const taskItem = document.createElement('div');
					taskItem.className = 'bg-gray-50 p-4 rounded-lg shadow-sm';
					taskItem.id = taskId;
					taskItem.innerHTML = `
							<div class="bg-gray-50 p-4 rounded-lg shadow-sm">
								<div class="flex items-center justify-between">
									<label class="flex items-center space-x-3 cursor-pointer">
										<input type="checkbox" value="checked" id="checkbox_trabalhos-${taskCounter}" class="form-checkbox h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
										<span class="text-gray-700 font-medium" id="nome_trabalhos-${taskCounter}">${taskText}</span>
									</label>
									<button id="delete_trabalhos-${taskCounter}" class="text-red-500 text-2xl hover:text-red-700" >×</button>
								</div>
								<div class="mt-4 grid grid-cols-6 gap-4">
									<!-- Data -->
									<div class="col-span-6 sm:col-span-3">
										<label for="date-${taskCounter}" class="block text-sm font-medium text-gray-700">Data</label>
										<input type="text" id="date_trabalhos-${taskCounter}" class="datepicker mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
									</div>
									<!-- Horas Trabalhadas -->
									<div class="col-span-6 sm:col-span-3">
										<label for="hours-${taskCounter}" class="block text-sm font-medium text-gray-700">Horas Trabalhadas</label>
										<input type="number" id="hours_trabalhos-${taskCounter}" min="1" step="0.5" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
									</div>
									<!-- Colaboradores -->
									<div class="col-span-6">
										<label for="collaborators-${taskCounter}" class="block text-sm font-medium text-gray-700">Colaboradores</label>
										<input type="text" id="collaborators_trabalhos-${taskCounter}" placeholder="Nome dos colaboradores separados por vírgula" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
									</div>
									<!-- Descrição do Trabalho -->
									<div class="col-span-6">
										<label for="description-${taskCounter}" class="block text-sm font-medium text-gray-700">Descrição do Trabalho</label>
										<textarea id="description_trabalhos-${taskCounter}" rows="2" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"></textarea>
									</div>
								</div>
							</div>
						`;

					workTaskList.appendChild(taskItem);
					newWorkTaskInput.value = '';

					// Apply Flatpickr to newly added date field
					flatpickr(document.getElementById(`date_trabalhos-${taskCounter}`), {
						dateFormat: "d/m/Y",
						allowInput: true
					});

					// Delete button functionality
					document.getElementById(`delete_trabalhos-${taskCounter}`).addEventListener('click', function () {
						const taskItem = document.getElementById(taskId);
						if (taskItem) {
							workTaskList.removeChild(taskItem);
						}
					});

					// Increment task counter for next task
					taskCounter++;
				}
			});
		});

		document.addEventListener('click', function (event) {
			if (event.target.classList.contains('toggle-btn')) {
				const expandableSection = event.target.closest('.md\\:col-span-1').nextElementSibling;
				if (expandableSection.classList.contains('hidden')) {
					expandableSection.classList.remove('hidden');
					event.target.textContent = '-';
				} else {
					expandableSection.classList.add('hidden');
					event.target.textContent = '+';
				}
			}
		});

		document.addEventListener("DOMContentLoaded", function () {
			const tableBody = document.querySelector("tbody");
			const totalCell = document.getElementById("totalValue");
			const addRowBtn = document.getElementById("addRowBtn");
			const saveBtn = document.getElementById("saveBtn");

			let rowCounter = 0;

			function updateTotal() {
				let total = 0;
				const rows = tableBody.querySelectorAll("tr");
				rows.forEach(row => {
					const quantityInput = row.querySelector("td:nth-child(2) input");
					const unitPriceInput = row.querySelector("td:nth-child(4) input");
					var quantity = parseFloat(quantityInput.value);
					var unitPrice = parseFloat(unitPriceInput.value);

					const rowID = row.querySelector("td.hidden").textContent; // Get the row ID
					const quantidadeDiv = document.getElementById(`quantidade${rowID}`); // Get the dynamically created div
					const precoUniDiv = document.getElementById(`precoUni${rowID}`); // Get the dynamically created div
					const precoTotalDiv = document.getElementById(`precoTotal${rowID}`); // Get the dynamically created div
					// console.log(quantidadeDiv.value, precoUniDiv.value); // Log its value

					if (!isNaN(quantidadeDiv.value) && !isNaN(precoUniDiv.value)) { // Check if both inputs are valid numbers
						const subtotal = parseFloat(quantidadeDiv.value) * parseFloat(precoUniDiv.value); // Calculate subtotal
						total += subtotal; // Accumulate total
						precoTotalDiv.textContent = subtotal.toFixed(2) + "€"; // Update precoTotalDiv with the calculated subtotal
						totalCell.textContent = total.toFixed(2) * 1.23 + "€"; // Update total cell
					}

					if (!quantidadeDiv.value || !precoUniDiv.value) {
						precoTotalDiv.textContent = "0.00€";
						totalCell.textContent = "0.00€";
					}
				});
			}

			// Add event listener for input changes
			tableBody.addEventListener("input", function (event) {
				if (event.target.tagName === "INPUT") {
					updateTotal();
				}
			});

			// Add event listener for add row button
			addRowBtn.addEventListener("click", function () {
				addRow();
			});

			// Function to add a new row to the table
			function addRow() {
				rowCounter++;
				const newRow = document.createElement("tr");
				const rowID = `row_${rowCounter}`;
				newRow.innerHTML = `
					<td class="hidden">${rowID}</td>
					<td class="px-6 py-4 whitespace-nowrap"><input type="text" class="w-full border rounded-md" id="referencia${rowID}"></td>
					<td class="px-6 py-4 whitespace-nowrap"><input type="number" class="w-full border rounded-md" id="quantidade${rowID}"></td>
					<td class="px-6 py-4 whitespace-nowrap"><input type="text" class="w-full border rounded-md" id="designacao${rowID}"></td>
					<td class="px-6 py-4 whitespace-nowrap"><input type="number" class="w-full border rounded-md" id="precoUni${rowID}"></td>
					<td class="px-6 py-4 whitespace-nowrap" id="precoTotal${rowID}">0.00€</td>
				`;
				tableBody.appendChild(newRow);
			}

			addRow();
		});

		// JavaScript para controlar as visualizações
		// document.getElementById("folha-obra").addEventListener("click", function () {
		// 	// Exibe o conteúdo da Folha de Obra e esconde a Consulta de Folha
		// 	document.getElementById("folha-obra-conteudo").classList.remove("hidden");
		// 	document.getElementById("consulta-folha-conteudo").classList.add("hidden");
		// });

		// document.getElementById("consulta-folha").addEventListener("click", function () {
		// 	// Exibe o conteúdo da Consulta de Folha e esconde a Folha de Obra
		// 	document.getElementById("consulta-folha-conteudo").classList.remove("hidden");
		// 	document.getElementById("folha-obra-conteudo").classList.add("hidden");
		// });

		// Selecionando os links do menu de desktop
		const folhaObraDesktopLink = document.getElementById('folha-obra-desktop');
		const consultaFolhaDesktopLink = document.getElementById('consulta-folha-desktop');

		// Função para alternar a classe "active" nos itens do menu
		function selecionarMenuItemDesktop(linkSelecionado, linkAlternativo) {
			// Adiciona a classe de ativo no item selecionado
			linkSelecionado.classList.add('bg-gray-900', 'text-white');
			// Remove as classes do item alternativo, mas mantém a classe de texto branco
			linkAlternativo.classList.remove('bg-gray-900');
			linkAlternativo.classList.add('text-white');
		}

		// Adiciona o evento de clique para Folha de Obra
		folhaObraDesktopLink.addEventListener('click', function () {
			document.getElementById('folha-obra-conteudo').classList.remove('hidden');
			document.getElementById('consulta-folha-conteudo').classList.add('hidden');
			selecionarMenuItemDesktop(folhaObraDesktopLink, consultaFolhaDesktopLink);
		});

		// Adiciona o evento de clique para Consulta de Folha
		consultaFolhaDesktopLink.addEventListener('click', function () {
			document.getElementById('folha-obra-conteudo').classList.add('hidden');
			document.getElementById('consulta-folha-conteudo').classList.remove('hidden');
			selecionarMenuItemDesktop(consultaFolhaDesktopLink, folhaObraDesktopLink);
		});

		// Selecionando os links
		const folhaObraLink = document.getElementById('folha-obra-link');
		const consultaFolhaLink = document.getElementById('consulta-folha-link');

		// Função para alternar a classe "active" nos itens do menu
		function selecionarMenuItemMobile(linkSelecionado, linkAlternativo) {
			// Adiciona a classe de ativo no item selecionado
			linkSelecionado.classList.add('bg-gray-900', 'text-white');
			linkAlternativo.classList.remove('bg-gray-900', 'text-white');
		}

		// Adiciona o evento de clique para Folha de Obra
		folhaObraLink.addEventListener('click', function () {
			document.getElementById('folha-obra-conteudo').classList.remove('hidden');
			document.getElementById('consulta-folha-conteudo').classList.add('hidden');
			selecionarMenuItemMobile(folhaObraLink, consultaFolhaLink);
		});

		// Adiciona o evento de clique para Consulta de Folha
		consultaFolhaLink.addEventListener('click', function () {
			document.getElementById('folha-obra-conteudo').classList.add('hidden');
			document.getElementById('consulta-folha-conteudo').classList.remove('hidden');
			selecionarMenuItemMobile(consultaFolhaLink, folhaObraLink);
		});

		// Function to get the next auto-increment ID
		async function getNextId() {
			const counterDocRef = doc(db, "counters", "folhaObraCounter");

			// Get the current counter value
			const counterDocSnap = await getDoc(counterDocRef);

			let nextId = 1;
			if (counterDocSnap.exists()) {
				nextId = counterDocSnap.data().counter + 1;
			}

			// Update the counter document
			await setDoc(counterDocRef, { counter: nextId });

			return nextId;
		}

		document.getElementById("saveBtn").addEventListener("click", async function () {
			event.preventDefault();
			// Collect data (same as before)
			const embarcacaoData = {
				nome: document.getElementById("nome_embarcacao").value,
				local: document.getElementById("local_embarcacao").value,
				cais: document.getElementById("cais_embarcacao").value,
			};

			const faturacaoData = {
				fatura: document.getElementById("nfatura").value,
				data: document.getElementById("data_fatura").value,
				observacoes: document.getElementById("observacoes_fatura").value,
			};

			const embarcacaoSpecs = {
				marca: document.getElementById("marca").value,
				modelo: document.getElementById("modelo").value,
				tamanho: document.getElementById("tamanho").value,
				motor: document.getElementById("motor").value,
				nserie: document.getElementById("nserie").value,
			};

			const clienteData = {
				nome: document.getElementById("nome_cliente").value,
				empresa: document.getElementById("empresa_cliente").value,
				morada: document.getElementById("morada_cliente").value,
				cp: document.getElementById("cp_cliente").value,
				telefone: document.getElementById("telefone_cliente").value,
				email: document.getElementById("email_cliente").value,
				contribuinte: document.getElementById("contribuinte_cliente").value,
			};

			const tarefas = [];
			let taskCounter = 0;
			while (document.getElementById(`task-${taskCounter}`)) {
				const taskData = {
					nome: document.getElementById(`text_servicos-task-${taskCounter}`)
						.innerHTML,
					checkbox: document.getElementById(`checkbox_servicos-task-${taskCounter}`)
						.checked,
					notes: document.getElementById(`notes_servicos-task-${taskCounter}`)
						.value,
					receptionDate: document.getElementById(
						`reception-date_servicos-task-${taskCounter}`
					).value,
					deliveryDate: document.getElementById(
						`delivery-date_servicos-task-${taskCounter}`
					).value,
					responsible: document.getElementById(
						`responsible_servicos-task-${taskCounter}`
					).value,
				};
				tarefas.push(taskData);
				taskCounter++;
			}

			const trabalhos = [];
			let trabalhoCounter = 0;
			while (document.getElementById(`task-${trabalhoCounter}`)) {
				const trabalhoData = {
					checkbox: document.getElementById(`checkbox_trabalhos-${trabalhoCounter}`)
						.checked,
					date: document.getElementById(`date_trabalhos-${trabalhoCounter}`).value,
					hours: document.getElementById(`hours_trabalhos-${trabalhoCounter}`)
						.value,
					collaborators: document.getElementById(
						`collaborators_trabalhos-${trabalhoCounter}`
					).value,
					description: document.getElementById(
						`description_trabalhos-${trabalhoCounter}`
					).value,
				};
				trabalhos.push(trabalhoData);
				trabalhoCounter++;
			}

			const materials = [];
			const rows = document.querySelectorAll("#materialTable tbody tr");

			rows.forEach((row) => {
				const hiddenCell = row.querySelector("td.hidden");
				if (!hiddenCell) {
					console.warn("Hidden cell not found in row:", row);
					return;
				}

				const rowID = hiddenCell.textContent.trim();
				console.log("Processing row with ID:", rowID);

				const quantidade = document.getElementById(`quantidade${rowID}`).value;
				const precoUni = document.getElementById(`precoUni${rowID}`).value;
				const precoTotal = parseFloat(
					document.getElementById(`precoTotal${rowID}`).innerHTML
				);
				const precoTotalcIva = parseFloat(
					document.getElementById("totalValue").textContent
				);
				const referencia = document.getElementById(`referencia${rowID}`).value;
				const designacao = document.getElementById(`designacao${rowID}`).value;

				const materialData = {
					quantidade,
					precoUni,
					precoTotal,
					referencia,
					designacao,
					precoTotalcIva,
				};
				console.log("Adding material:", materialData);
				materials.push(materialData);
			});

			console.log("Final materials array:", materials);

			// Collect all data into a final object
			const finalData = {
				embarcacao: embarcacaoData,
				faturacao: faturacaoData,
				especificacoes: embarcacaoSpecs,
				cliente: clienteData,
				tarefas: tarefas,
				trabalhos: trabalhos,
				materiais: materials,
			};

			try {
				// Get the next available document ID
				const nextId = await getNextId();

				// Add data to Firestore with the custom document ID
				const docRef = doc(db, "folhaObra", nextId.toString());
				console.log("Final data:", finalData);

				await setDoc(docRef, finalData);

				console.log("Document written with ID: ", nextId);

				// Show a SweetAlert success message
				await Swal.fire({
					title: "Successo!",
					text: "Folha de obra guardada com sucesso.",
					icon: "success",
					confirmButtonText: "OK",
				});

				// Perform a hard refresh after the user closes the SweetAlert
				window.location.reload();
			} catch (error) {
				console.error("Error adding document: ", error);

				// Show SweetAlert error message if something goes wrong
				await Swal.fire({
					title: "Erro!",
					text: "Ocorreu um erro a guardar a folha.",
					icon: "error",
					confirmButtonText: "Tentar outra vez",
				});
			}
		});
	</script>
</body>

</html>
